"use strict";function n(n){t(wx.request,n)}function t(n,t){var e=t.success,i=t.fail,r=!1,o=null;t.success=function(n){if(!r){o&&clearTimeout(o);"function"==typeof e&&e(n)}};t.fail=function(){if(!r){o&&clearTimeout(o);"function"==typeof i&&i()}};n(t);o=setTimeout(()=>{o&&clearTimeout(o);r=!0;"function"==typeof i&&i(r)},t.timeout||X)}function e(t){try{n(t)}catch(n){M().e("请求失败: "+n)}}function i(n){return sn.encode(n,!1)}function r(n){return sn.decode(n)}function o(n){for(var t="",e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],i=0;i<Number(n);i++)t+=e[Math.round(Math.random()*(e.length-1))];return t}function a(n){return!Number.isNaN(parseInt(n,10))}function u(n,t){for(var e=String(n).split("."),i=String(t).split("."),r=0;r<Math.max(e.length,i.length);r++){var o=parseInt(e[r]||0,10),a=parseInt(i[r]||0,10);if(o>a)return 1;if(o<a)return-1}return 0}function c(n){return JSON.parse(JSON.stringify(n))}function s(n,t){return!(!n||!t||0===t.length||t.length>n.length)&&n.substr(0,t.length)===t}function f(n,t){return!(!t||0===n.length||t.length>n.length)&&n.substring(n.length-t.length)===t}function p(n){if(void 0===n||null===n)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(n),e=1;e<arguments.length;e++){var i=arguments[e];if(i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}function l(n,t){if(n===t)return!0;if(n&&"object"==typeof n&&t&&"object"==typeof t){if(Object.keys(n).length!==Object.keys(t).length)return!1;for(var e in n){if(Object.prototype.hasOwnProperty.call(t,e))return!1;if(!l(n[e],t[e]))return!1}return!0}return!1}function d(n,t){if(!n)return"";if("string"==typeof t&&t.length){var e=new RegExp("^"+t+"*");n=n.replace(e,"")}else n=n.replace(/^s*/,"");return n}function h(n,t){if(!n)return"";var e,i;if("string"==typeof t&&t.length){e=new RegExp(t);i=n.length;for(;e.test(n.charAt(i));)i-=1;return n.slice(0,i+1)}e=/s/;i=n.length-1;for(;e.test(n.charAt(i));)i-=1;return n.slice(0,i+1)}function g(n){var t=null;switch(n){case On.HALF_SESSION:t=v();break;case On.CLOSE_SESSION:t=_();break;case On.EKV:t=y()}return t}function v(){var n=null,t=wn().cloneCurrentSession();t&&(n={header:{st:"1"},analytics:{sessions:[t]}});return n}function _(){var n=null,t={},e=wn().cloneCurrentSession();if(e){var i=q().get(),r=dn().get();Array.isArray(i)&&i.length&&(e.pages=fn.clone(i));Array.isArray(r)&&r.length&&(e.shares=fn.clone(r));q().clear();dn().clear();t.sessions=[e]}var o=_n().getEkvs();if(o){t.ekvs=fn.clone(o);_n().clear()}(t.sessions||t.ekvs)&&(n={analytics:t});return n}function y(){var n=null,t=_n().getEkvs();if(t){n={analytics:{ekvs:fn.clone(t)}};_n().clear()}return n}function m(n){return{h:E(n.header,kn),a:I(n.analytics,Rn)}}function E(n,t){var e=S(n,t);n.id_tracking&&(e[t.id_tracking||"id_tracking"]=S(n.id_tracking,Pn));return e}function S(n,t){var e={};for(var i in n)t[i]?e[t[i]]=n[i]:e[i]=n[i];return e}function I(n,t){var e={};if(n)for(var i in n)n[i]&&(e[t[i]]=n[i]);return e}function T(n,t,i,r){Nn.instance().setIdType(pn().getIdType());Nn.instance().setIdTracking(pn().getIdTracking());var o=pn().getUserId();o&&n.analytics&&(n.analytics.active_user={puid:o,provider:pn().getProvider()});var a=fn.clone(Nn.instance().get());n.header=fn.assign(a,n.header,{ts:Date.now(),testToken:Ln().getToken(),traceId:fn.getRandomStr(10)+Date.now()+fn.getRandomStr(9)});var u=m(n),c=j.stringify(u),s={url:H.LOG_URL,method:"POST",data:fn.base64Encode(c),success:function(e){var r=e.code||e.status||e.statusCode;if(200===r||413===r){M().i("数据发送成功: ",n,c);A((e.data||{}).imprint);"function"==typeof t&&t(e)}else{M().w("数据发送失败: ",c);"function"==typeof i&&i()}},fail:function(n){M().w("超时: ",c);"function"==typeof i&&i()},complete:function(){"function"==typeof r&&r()}};e(fn.assign(s,N()))}function A(n){if(n){K().set(H.IMPRINT,n);Nn.instance().setItem(H.IMPRINT,n);var t=j.parse(fn.base64Decode(n));M().v("imprint: %o",t);var e=t.report_policy;if(e&&fn.isNumber(e)){K().set(H.REPORT_POLICY,e);if(e===H.REPORT_POLICY_INTERVAL){var i=t.report_interval;if(i&&fn.isNumber(i)){i<=H.EVENT_SEND_MIN_INTERVAL?i=H.EVENT_SEND_MIN_INTERVAL:i>H.EVENT_SEND_MAX_INTERVAL&&(i=H.EVENT_SEND_MAX_INTERVAL);K().set(H.REPORT_INTERVAL_TIME,i)}}}t.ttn_invalid&&Ln().clear()}}function N(){;"wxmp/json";return{header:{"Content-Type":"wxmp/json","Msg-Type":"wxmp/json"}}}function O(n){var t=n,e=[];this.enqueue=function(n){"number"==typeof t&&this.size()>=t&&this.dequeue();e.push(n)};this.dequeue=function(){return e.shift()};this.front=function(){return e[0]};this.isEmpty=function(){return 0===e.length};this.clear=function(){e.length=0};this.size=function(){return e.length};this.items=function(){return e};this.print=function(){console.log(e.toString())}}function w(n,t){this.id=n;this.ts=Date.now();var e=typeof t;if("string"===e&&t)this[n]=t;else if("object"===e)for(var i in t)({}).hasOwnProperty.call(t,i)&&(this[i]=t[i])}function R(){function n(){pn().init(function(){Nn.instance().init();M().v("Header初始化成功")})}function t(n,t){return"number"!=typeof o||"number"!=typeof t||(o<=0||n-o>t)}function e(n,t){if(!n||"string"!=typeof n){M().e('please check trackEvent id. id should be "string" and not null');return!1}var e=["id","ts","du"],i={};e.forEach(function(n){i[n]=1});if(i[n]){M().e("eventId不能与以下保留字冲突: "+e.join(","));return!1}if(n.length>H.MAX_EVENTID_LENGTH){M().e("The maximum length of event id shall not exceed "+H.MAX_EVENTID_LENGTH);return!1}if(t&&("object"!=typeof t||Array.isArray(t))&&"string"!=typeof t){M().e("please check trackEvent properties. properties should be string or object(not include Array)");return!1}if("object"==typeof t){var r=0;for(var o in t)if({}.hasOwnProperty.call(t,o)){if(o.length>H.MAX_PROPERTY_KEY_LENGTH){M().e("The maximum length of property key shall not exceed "+H.MAX_PROPERTY_KEY_LENGTH);return!1}if(r>=H.MAX_PROPERTY_KEYS_COUNT){M().e("The maximum count of properties shall not exceed "+H.MAX_PROPERTY_KEYS_COUNT);return!1}if(i[o]){M().e("属性中的key不能与以下保留字冲突: "+e.join(","));return!1}r+=1}}return!0}var i=!1,r=!1,o=0;this.init=function(t){M().v("sdk version: "+H.IMPL_VERSION);i?M().v("Lib重复实例化"):K().load(function(){M().v("cache初始化成功: ",K().getAll());n();i=!0;"function"==typeof t&&t();M().tip("SDK集成成功")})};this.resume=function(n){if(i&&!r){M().v("showOptions: ",n);var t=this;r=!0;var e=wn().resume(n),o=wn().getCurrentSessionId();_n().setSessionId(o);Ln().init(function(){bn().load();e&&bn().add(On.HALF_SESSION,{},function(){F().useOpenid()&&F().autoGetOpenid()&&!pn().getId()?pn().getOpenIdAsync({success:function(n){M().v("获取openid成功: %s",n);t.setOpenid(n)},fail:function(){M().v("获取openid失败")}}):bn().send()})})}};this.pause=function(){if(i){r=!1;o=0;wn().pause();F().uploadUserInfo()&&Cn().update();bn().send(On.CLOSE_SESSION,{},function(){bn().save();K().save();M().v("cache save success")})}};this.setOpenid=function(n){M().v("setOpenId: %s",n);pn().setOpenid(n);bn().send()};this.setUnionid=function(n){M().v("setUnionid: %s",n);pn().setUnionid(n)};this.setUserid=function(n,t){M().v("setUserid: %s",n,t);pn().setUserid(n,t)};this.trackEvent=function(n,r){if(i){M().v("event: ",n,r);if(e(n,r)){var a=new w(n,r);_n().addEvent(a);var u=!!Ln().getToken(),c=u?0:H.EVENT_SEND_DEFAULT_INTERVAL,s=Date.now();if(t(s,c)){o=s;bn().send(On.EKV,{noCache:u},function(){})}}}};this.trackShare=function(n){if(i){try{n=dn().add(n);M().v("sharePath: ",n.path)}catch(n){M().v("shareAppMessage: ",n)}return n}};this.trackPageStart=function(n){i&&q().addPageStart(n)};this.trackPageEnd=function(n){i&&q().addPageEnd(n)}}function k(){}function P(n,t,e){var i=n[t];n[t]=function(n){e.call(this,n);i&&i.call(this,n)}}function U(n){try{Kn.init(n)}catch(n){M().v("onAppLaunch: ",n)}}function D(n){try{Kn.resume(n)}catch(n){M().v("onAppShow: ",n)}}function L(){try{Kn.pause()}catch(n){M().v("onAppHide: ",n)}}function b(){try{Kn.trackPageStart(this.route)}catch(n){M().v("onPageShow: ",n)}}function C(){try{Kn.trackPageEnd(this.route)}catch(n){M().v("onPageHide: ",n)}}var x="[UMENG] -- ",M=function(){function n(){this.setDebug=function(n){e=n};this.d=function(){if(e)try{"string"==typeof arguments[0]&&(arguments[0]=x+arguments[0]);console.debug.apply(console,arguments)}catch(n){}};this.i=function(){try{if(e)try{"string"==typeof arguments[0]&&(arguments[0]=x+arguments[0]);console.info.apply(console,arguments)}catch(n){}}catch(n){}};this.e=function(){if(e)try{"string"==typeof arguments[0]&&(arguments[0]=x+arguments[0]);console.error.apply(console,arguments)}catch(n){}};this.w=function(){if(e)try{"string"==typeof arguments[0]&&(arguments[0]=x+arguments[0]);console.warn.apply(console,arguments)}catch(n){}};this.v=function(){if(e)try{"string"==typeof arguments[0]&&(arguments[0]=x+arguments[0]);console.log.apply(console,arguments)}catch(n){}};this.t=function(){if(e)try{console.table.apply(console,arguments)}catch(n){}};this.tip=function(){try{"string"==typeof arguments[0]&&(arguments[0]=x+arguments[0]);console.log.apply(console,arguments)}catch(n){}};this.tip_w=function(n){try{console.log("%c "+x+n,"background:red; padding: 4px; padding-right: 8px; border-radius: 4px; color: #fff;")}catch(n){}};this.err=function(){try{"string"==typeof arguments[0]&&(arguments[0]=x+arguments[0]);console.error.apply(console,arguments)}catch(n){}}}var t=null,e=!1;return function(){null===t&&(t=new n);return t}}(),V={set:function(n,t,e){var i,r={key:n,success:function(n){"function"==typeof e&&e(n)},fail:function(){"function"==typeof e&&e()}};r.data=t;i=wx.setStorage;try{i&&i(r)}catch(n){M.e("存储错误",n)}},get:function(n,t){var e;e=wx.getStorage;try{e&&e({key:n,success:function(n){"function"==typeof t&&t(n.data)},fail:function(e){M().w(n+": "+e.errMsg);"function"==typeof t&&t()}})}catch(n){M.e("获取storage错误",n)}},remove:function(n,t){var e;e=wx.removeStorage;try{e&&e({key:n,success:function(){"function"==typeof t&&t(!0)},fail:function(){"function"==typeof t&&t(!1)}})}catch(n){M.e("删除storage错误",n)}}},j={stringify:function(n){if(n)try{return JSON.stringify(n)}catch(n){}return""},parse:function(n){if(n)try{return JSON.parse(n)}catch(n){}return null},parseToArray:function(n){if(n)try{return JSON.parse(n)}catch(n){}return[]}},F=function(){function n(){var n={};this.useOpenid=function(){return n.useOpenid};this.autoGetOpenid=function(){return n.autoGetOpenid};this.appKey=function(){return n.appKey};this.uploadUserInfo=function(){return n.uploadUserInfo};this.set=function(t){n=t};this.get=function(){return n};this.setItem=function(t,e){n[t]=e};this.getItem=function(t){return n[t]}}var t=null;return function(){t||(t=new n);return t}}(),K=function(){function n(){this.load=function(n){if(i){V.remove(e);n()}else{e="um_cache_"+F().appKey();V.get(e,function(t){i=j.parse(t)||{};r=!0;V.remove(e);n()})}};this.save=function(){i&&V.set(e,j.stringify(i))};this.set=function(n,t){i&&(i[n]=t)};this.get=function(n){return(i||{})[n]};this.remove=function(n){i&&i[n]&&delete i[n]};this.getAll=function(){return i};this.clear=function(){i=null};this.has=function(n){return!!this.get(n)};this.isLoaded=function(){return r}}var t=null,e="",i=null,r=!1;return function(){t||(t=new n);return t}}(),G="",H={SESSION_INTERVAL:3e4,LOG_URL:G="https://umini.shujupie.com/wxm_logs",GET_OPENID_URL:"https://umini.shujupie.com/uminiprogram_logs/wx/getuut",USERINFO_URL:"https://umini.shujupie.com/uminiprogram_logs/comm/uif",DEVICE_INFO_KEY:"device_info",ADVERTISING_ID:"mobile_ad_id",ANDROID_ID:"android_id",CURRENT_SESSION:"current_session",SESSION_PAUSE_TIME:"session_pause_time",EVENT_SEND_DEFAULT_INTERVAL:15e3,EVENT_LAST_SEND_TIME:"last_send_time",MAX_EVENTID_LENGTH:128,MAX_PROPERTY_KEY_LENGTH:256,MAX_PROPERTY_KEYS_COUNT:100,REPORT_POLICY:"report_policy",REPORT_INTERVAL_TIME:"report_interval_time",REPORT_POLICY_START_SEND:"1",REPORT_POLICY_INTERVAL:"6",IMPRINT:"imprint",SEED_VERSION:"1.0.0",IMPL_VERSION:"2.3.4",ALIPAY_AVAILABLE_VERSION:"10.1.52",SHARE_PATH:"um_share_path",SHARES:"shares",REQUESTS:"requests",UUID:"um_uuid",UUID_SUFFIX:"ud",OPENID:"um_od",UNIONID:"um_unid",ALIPAYID:"um_alipayid",USERID:"um_userid",PROVIDER:"um_provider",LAUNCH_OPTIONS:"LAUNCH_OPTIONS",UM_SSRC:"_um_ssrc",USER_INFO:"user_info",IS_ALIYUN:!1,ALIYUN_URL:"serverless.huoban.youmeng.network.forward"},Y={getUserInfo:function(n){wx.getSetting({success(t){t.authSetting["scope.userInfo"]?wx.getUserInfo({success:function(t){n(t&&t.userInfo)},fail:function(){n({})}}):n({})},fail(){n({})}})},getSystemInfo:function(n,t){wx.getSystemInfo({success:function(t){"function"==typeof n&&n(t)},fail:function(){"function"==typeof t&&t()}})},getDeviceInfo:function(n){"function"==typeof n&&n()},checkNetworkAvailable:function(n){var t={success:function(t){var e=!1;e="none"!==t.networkType;"function"==typeof n&&n(e)},fail:function(){"function"==typeof n&&n()}};wx.getNetworkType(t)},getNetworkInfo:function(n,t){var e={success:function(t){"function"==typeof n&&n(t)},fail:function(){"function"==typeof t&&t()}};wx.getNetworkType(e)},getDeviceId:function(n,t){try{"function"==typeof n&&n("")}catch(n){M().e("getDeviceId error",n)}},getAdvertisingId:function(n,t){"function"==typeof n&&n("")},getPageName:function(){},onNetworkStatusChange:function(n){wx.onNetworkStatusChange(function(t){"function"==typeof n&&n(t.isConnected||!0)})}},q=function(){function n(){var n=!1,t=null,e=[];this.addPageStart=function(e){if(e&&!n){t={ts:Date.now(),path:e,page_name:e};n=!0}};this.addPageEnd=function(i){if(n&&i&&t&&i===t.page_name){var r=Date.now()-t.ts;t.duration=Math.abs(r);e.push(t);t=null;n=!1}};this.get=function(){return e};this.getCurrentPage=function(){return t};this.clear=function(){e.length=0}}var t=null;return function(){t||(t=new n);return t}}(),X=5e3,J="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",W=function(n){for(var t={},e=0,i=n.length;e<i;e++)t[n.charAt(e)]=e;return t}(J),z=String.fromCharCode,Q=function(n){if(n.length<2)return(t=n.charCodeAt(0))<128?n:t<2048?z(192|t>>>6)+z(128|63&t):z(224|t>>>12&15)+z(128|t>>>6&63)+z(128|63&t);var t=65536+1024*(n.charCodeAt(0)-55296)+(n.charCodeAt(1)-56320);return z(240|t>>>18&7)+z(128|t>>>12&63)+z(128|t>>>6&63)+z(128|63&t)},B=function(n){return n.replace(/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Q)},Z=function(n){var t=[0,2,1][n.length%3],e=n.charCodeAt(0)<<16|(n.length>1?n.charCodeAt(1):0)<<8|(n.length>2?n.charCodeAt(2):0);return[J.charAt(e>>>18),J.charAt(e>>>12&63),t>=2?"=":J.charAt(e>>>6&63),t>=1?"=":J.charAt(63&e)].join("")},$=function(n){return n.replace(/[\s\S]{1,3}/g,Z)},nn=function(n){return $(B(n))},tn=function(n,t){return t?nn(String(n)).replace(/[+\/]/g,function(n){return"+"==n?"-":"_"}).replace(/=/g,""):nn(String(n))},en=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),rn=function(n){switch(n.length){case 4:var t=((7&n.charCodeAt(0))<<18|(63&n.charCodeAt(1))<<12|(63&n.charCodeAt(2))<<6|63&n.charCodeAt(3))-65536;return z(55296+(t>>>10))+z(56320+(1023&t));case 3:return z((15&n.charCodeAt(0))<<12|(63&n.charCodeAt(1))<<6|63&n.charCodeAt(2));default:return z((31&n.charCodeAt(0))<<6|63&n.charCodeAt(1))}},on=function(n){return n.replace(en,rn)},an=function(n){var t=n.length,e=t%4,i=(t>0?W[n.charAt(0)]<<18:0)|(t>1?W[n.charAt(1)]<<12:0)|(t>2?W[n.charAt(2)]<<6:0)|(t>3?W[n.charAt(3)]:0),r=[z(i>>>16),z(i>>>8&255),z(255&i)];r.length-=[0,0,2,1][e];return r.join("")},un=function(n){return n.replace(/[\s\S]{1,4}/g,an)},cn=function(n){return on(un(n))},sn={encode:tn,decode:function(n){return cn(String(n).replace(/[-_]/g,function(n){return"-"==n?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))}},fn={base64Encode:i,base64Decode:r,isNumber:a,compareVersion:u,getRandomStr:o,clone:c,startsWith:s,endsWith:f,assign:p,deepEqual:l,trimStart:d,trimEnd:h},pn=function(){function n(){function n(){return fn.getRandomStr(10)+Date.now()+fn.getRandomStr(7)+H.UUID_SUFFIX}var t="",i="",r="",o="",a="",u="";this.init=function(e){u=F().useOpenid()?"openid":"uuid";V.get(H.UUID,function(o){if(o)t=o;else{t=n();V.set(H.UUID,t)}F().useOpenid()?V.get(H.OPENID,function(n){i=n;e&&e()}):e&&e();V.get(H.UNIONID,function(n){r=n})})};V.get(H.USERID,function(n){!o&&n&&(o=n)});V.get(H.PROVIDER,function(n){!a&&n&&(a=n)});this.getOpenIdAsync=function(n){wx.login({success:function(t){t.code?e({url:H.GET_OPENID_URL,method:"GET",data:{key:F().appKey(),code:t.code},success:function(t){if(t&&200===t.statusCode&&t.data&&t.data.data){var e=t.data.data;return n.success&&n.success(e.oid,e.uid)}n.fail&&n.fail()},fail:function(){n.fail&&n.fail()}}):n.fail&&n.fail()},fail:function(){n.fail&&n.fail()}})};this.getIdType=function(){return u};this.getIdTracking=function(){var n={};t&&(n.uuid=t);i&&(n.openid=i);r&&(n.unionid=r);o&&(n.userid=o);return n};this.setOpenid=function(n){if(n&&n!==i){i=n;V.set(H.OPENID,n)}};this.setUnionid=function(n){if(!r&&n){r=n;V.set(H.UNIONID,n)}};this.setUserid=function(n,t){if(n&&n!==o){o=n;V.set(H.USERID,n);a=t;V.set(H.PROVIDER,t)}};this.getId=function(){return F().useOpenid()?i:t};this.getUserId=function(){return o};this.getProvider=function(){return a}}var t=null;return function(){t||(t=new n);return t}}(),ln=3,dn=function(){function n(){return{add:function(n){M().v("share origin: %o",n);var t={title:n&&n.title,path:n&&n.path&&n.path.split("?")[0],_um_sts:Date.now()};t.path&&t.path.length>1&&fn.startsWith(t.path,"/")&&(t.path=fn.trimStart(t.path,"/"));var r=n.path||"",o=pn().getId();if(o){var a=i.split(","),u=(a=a.filter(function(n){return n.length>0})).indexOf(o);u>=0&&(a=a.slice(0,u));a.length<ln&&a.push(o);var c=a.join(",");-1!==r.indexOf("?")?r+="&_um_ssrc="+c:r+="?_um_ssrc="+c;var s=Date.now();r+="&_um_sts="+s;n.path=r;t._um_ssrc=c;t._um_sts=s}e.push(t);M().v("share: %o",n);return n},setShareSource:function(n){i=n},clear:function(){e.length=0},get:function(){return e}}}var t=null,e=[],i="";return function(){t||(t=new n);return t}}(),hn="ekvs",gn=1e4,vn=1,_n=function(){function n(){if(a.length){var n=K().get(hn);if(e(n)+a.length<=gn){n=t(n,a);K().set(hn,n)}}}function t(n,t){var e=(n=n||{})[o];Array.isArray(e)&&e.length?n[o]=e.concat(t):n[o]=[].concat(t);return n}function e(n){var t=0;for(var e in n)Array.isArray(n[e])&&(t+=n[e].length);return t}function i(){return{addEvent:function(t){if(o){a.unshift(t);if(a.length>vn){n(o);a.length=0}}else{M().w("session id is null: ",o);u.unshift(t)}},setSessionId:function(n){o=n;M().v("setSessionId: ",o);if(Array.isArray(u)&&u.length&&o){for(var t=0;t<u.length;t++)this.addEvent(u[t]);u.length=0}},getEkvs:function(){var n=K().get(hn);a&&a.length&&(n=t(n,a));return n},clear:function(){K().remove(hn);a.length=0}}}var r,o,a=[],u=[];return function(){r||(r=i());return r}}(),yn={getClipboard:function(n){var t;t=wx.getClipboardData;try{t&&t({success:function(t){var e=t.data;"function"==typeof n&&n(e)},fail:function(){"function"==typeof n&&n("")}})}catch(n){M.e("读取clipboard发生错误",n)}},showModal:function(n){var t;t=wx.showModal;try{t&&t(n)}catch(n){M.e("展示Modal时发生错误",n)}},showToast:function(n){var t;t=wx.showToast;try{t&&t(n)}catch(n){M.e("showToast error",n)}},getUserInfo:function(n){var t,e={fail:function(){n&&n()}};t=wx.getUserInfo;e.success=function(t){if(t&&t.userInfo){var e=t.userInfo;n&&n({avatar:e.avatarUrl,nickName:e.nickName,gender:e.gender,country:e.country,province:e.province,city:e.city,language:e.language})}};try{wx.getSetting({success:function(n){n.authSetting["scope.userInfo"]&&t&&t(e)},fail:function(){n()}})}catch(n){M.e("showToast error",n)}},getAppInfoSync:function(){var n=wx.getAccountInfoSync(),t=n&&n.miniProgram?n.miniProgram:{};return{appId:t.appId,appEnv:t.envVersion,appVersion:t.version}}},mn="2g",En="3g",Sn="4g",In="none",Tn=" ",An=["access","access_subtype"],Nn=function(){function n(){function n(n){Y.getSystemInfo(function(i){Y.getNetworkInfo(function(o){var a=(o=o||{}).type||o.networkType;a===In&&(a="unknown");var u=K().get(H.IMPRINT);u&&(r.imprint=u);t(i,a);e(i);n&&n()})})}function t(n,t,e){r.userInfo=e;r.device_type="Phone";r.sdk_version=H.IMPL_VERSION;r.appkey=F().appKey();if(n){var i,o,a,u=n.model||"",c=(n.product,n.platform||""),s=n.brand||"",f=s.toLowerCase();r.platform_sdk_version=n.SDKVersion;r.platform_version=n.version;a=(i=Math.round(n.screenWidth*n.pixelRatio))>(o=Math.round(n.screenHeight*n.pixelRatio))?i+"*"+o:o+"*"+i;r.os=c;r.font_size_setting=n.fontSizeSetting;r.device_model=u;r.device_brand=s;r.device_manufacturer=f;r.device_manuid=u.toLowerCase().indexOf(f)>-1?u:f+Tn+u;r.device_name=u.toLowerCase().indexOf(f)>-1?u:f+Tn+u;r.os_version=n.system;r.resolution=a;r.language=n.language}switch(t=t?t.toLowerCase():""){case Sn:r.access_subtype="LTE";r.access="4G";break;case En:r.access_subtype="CDMA";r.access="3G";break;case mn:r.access_subtype="GRPS";r.access="2G";break;default:r.access=t;delete r.access_subtype}}function e(n){var t=[];if(n){t.push({name:"系统名",value:n.platform});t.push({name:"支付宝版本号",value:n.version})}t.push({name:"设备型号",value:r.device_model});t.push({name:"设备生产商",value:r.device_brand});t.push({name:"os版本号",value:r.os_version});t.push({name:"网络类型",value:r.access});t.push({name:"运营商",value:r.access_subtype});t.push({name:"分辨率",value:r.resolution});t.push({name:"screenWidth",value:n.screenWidth});t.push({name:"screenHeight",value:n.screenHeight});t.push({name:"pixelRatio",value:n.pixelRatio});for(var e="",i=0;i<t.length;i++){var o=t[i];e+=o.name+": "+o.value+"; "}M().v("调试辅助信息: ",e)}var i=!1,r={};r.sdk_type="wxmp";r.platform="wx";var o=yn.getAppInfoSync();r.appid=o.appId;r.app_env=o.appEnv;r.app_version=o.appVersion;return{init:function(){n(function(){i=!0})},isLoaded:function(){return i},get:function(){return r},getSDKType:function(){return r.sdk_type},getPlatform:function(){return r.platform},getRealtimeFields:function(){var n={};An.forEach(function(t){n[t]=r[t]});return n},setIdTracking:function(n){this.setItem("id_tracking",n)},setIdType:function(n){this.setItem("id_type",n)},setItem:function(n,t){r[n]=t},getItem:function(n){return r[n]},updateExtraInfo:function(){Y.getDeviceInfo(function(n){r.device_info=n||""})}}}var t=null;return{instance:function(){t||(t=n());return t}}}(),On={HALF_SESSION:"half_session",CLOSE_SESSION:"close_session",EKV:"ekv",ENTER_PAGE:"enter_page",LEAVE_PAGE:"leave_page"},wn=function(){function n(){return{resume:function(n){var t=!1;a||(a=K().get(H.CURRENT_SESSION));var i=new Date;o=i.getTime();if(!a||!a.end_time||o-a.end_time>H.SESSION_INTERVAL){t=!0;e(n);M().v("开始新的session(%s): ",a.id,a)}else M().v("延续上一次session(%s): %s ",a.id,i.toLocaleTimeString(),a);return t},pause:function(){i()},getCurrentSessionId:function(){return(a||{}).id},getCurrentSession:function(){return a},cloneCurrentSession:function(){return fn.clone(a)}}}function t(n){var t={};for(var e in n)0===e.indexOf("_um_")&&(t[e]=n[e]);return t}function e(n){try{var e=(a||{}).options||{},i=fn.assign({},t(n.query));i.path=n.path||e.path;i.scene=n.scene?Nn.instance().getPlatform()+"_"+n.scene:e.scene;var r=n.referrerInfo;r&&(i.referrerAppId=r.appId);M().v("session options: ",i);var o=i[H.UM_SSRC];o&&dn().setShareSource(o);var u=Date.now();a={id:fn.getRandomStr(10)+u,start_time:u,options:i}}catch(n){M().e("生成新session失败: ",n)}}function i(){if(a){var n=new Date;a.end_time=n.getTime();"number"!=typeof a.duration&&(a.duration=0);a.duration=a.end_time-o;K().set(H.CURRENT_SESSION,a);M().v("退出会话(%s): %s ",a.id,n.toLocaleTimeString(),a)}}var r=null,o=null,a=null;return function(){r||(r=n());return r}}(),Rn={sessions:"sn",ekvs:"e",active_user:"active_user"},kn={sdk_type:"sdt",access:"ac",access_subtype:"acs",device_model:"dm",language:"lang",device_type:"dt",device_manufacturer:"dmf",device_name:"dn",platform_version:"pv",id_type:"it",font_size_setting:"fss",os_version:"ov",device_manuid:"did",platform_sdk_version:"psv",device_brand:"db",appkey:"ak",_id:"id",id_tracking:"itr",imprint:"imp",sdk_version:"sv",resolution:"rl",testToken:"ttn"},Pn={uuid:"ud",unionid:"und",openid:"od",alipay_id:"ad",device_id:"dd",userid:"puid"},Un="_UMTEST_",Dn="TEST_TOKEN",Ln=function(){function n(){this.init=function(n){yn.getClipboard(function(t){e=K().get(Dn);try{if(t&&fn.startsWith(t,Un)&&t.split(Un)[1]){var i=t.split(Un)[1],r=JSON.parse(i).token;if(r){e=r;K().set(Dn,r)}}}catch(n){M().v(n)}n(!!e)})};this.getToken=function(){return e};this.clear=function(){e="";K().remove(Dn)}}var t=null,e="";return function(){t||(t=new n);return t}}(),bn=function(){function n(t,e,i){if(Nn.instance().isLoaded()){e=e||{};var r=g(t);if(r){var o=Nn.instance().getRealtimeFields();r.header=fn.assign({},r.header,o);r.noCache=e.noCache;c.enqueue(r)}"function"==typeof i&&i()}else setTimeout(function(){n(t,e,i)},100)}function t(n){var i=c.front(),r=function(){c.dequeue();t(n)},o=function(){var e=c.dequeue();e&&!e.noCache&&u.push(e);t(n)};if(i)T(i,r,o);else{e();n()}}function e(){u.forEach(function(n){c.enqueue(n)});u.length=0}function i(n){if(pn().getId())if(a)M().i("队列正在发送中");else{a=!0;t(function(){a=!1;"function"==typeof n&&n()})}else{M().i("获取id标识失败，暂缓发送");"function"==typeof n&&n()}}function r(){this.send=function(n,t,e){n?this.add(n,t,function(){i(e)}):i(e)};this.add=function(t,e,i){n(t,e,i)};this.load=function(){var n=K().get(H.REQUESTS);n&&n.length&&n.forEach(function(n){c.enqueue(n)});K().remove(H.REQUESTS)};this.save=function(){K().set(H.REQUESTS,fn.clone(c.items()));c.clear()}}var o=null,a=!1,u=[],c=new O(50);return function(){o||(o=new r);return o}}(),Cn=function(){function n(){function n(n,t){var i=F().appKey(),r=Nn.instance().getSDKType(),o=pn().getId(),a=pn().getIdType();if(i&&r&&o&&a){var u={ak:F().appKey(),sdt:Nn.instance().getSDKType(),uin:n.nickName,uia:n.avatar,uig:n.gender,uit:n.country,uip:n.province,uic:n.city,uil:n.language,id:pn().getId(),it:pn().getIdType()},c=JSON.stringify(u);c=fn.base64Encode(c);e({url:H.USERINFO_URL,method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:"ui="+c,success:function(e){M().v("用户信息上传成功: ",n);t&&t(e&&e.data&&200===e.data.code)},fail:function(){M().e("用户信息上传失败: ",n);t&&t(!1)}})}}this.update=function(){yn.getUserInfo(function(t){if(t){var e=K().get(H.USER_INFO);e&&fn.deepEqual(t,e)||n(t,function(n){n&&K().set(H.USER_INFO,t)})}})}}var t=null;return function(){t||(t=new n);return t}}(),xn=[];k.prototype={createMethod:function(n,t,e){try{n[t]=e?function(){return e[t].apply(e,arguments)}:function(){xn.push([t,[].slice.call(arguments)])}}catch(n){M().v("create method errror: ",n)}},installApi:function(n,t){try{var e,i,r=["resume","pause","trackEvent","trackPageStart","trackPageEnd","trackShare","setOpenid","setUnionid","setUserid"];for(e=0,i=r.length;e<i;e++)this.createMethod(n,r[e],t);if(t)for(e=0,i=xn.length;e<i;e++){var o=xn[e];try{t[o[0]].apply(t,o[1])}catch(n){M().v("impl[v[0]].apply error: ",o[0],n)}}}catch(n){M().v("install api errror: ",n)}}};try{var Mn=App;App=function(n){P(n,"onLaunch",function(){U(n.umengConfig)});P(n,"onShow",D);P(n,"onHide",L);Mn(n)}}catch(n){M().w("App重写异常")}try{var Vn=Page;Page=function(n){P(n,"onShow",b);P(n,"onHide",C);P(n,"onUnload",C);if(n.onShareAppMessage){var t=n.onShareAppMessage;n.onShareAppMessage=function(e){var i=t.call(this,e)||{};i.path=i.path||n.route;return Kn.trackShare.call(this,i)}}Vn(n)}}catch(n){M().w("Page重写异常")}try{var jn=Component;Component=function(n){try{n.methods=n.methods||{};var t=n.methods;P(t,"onShow",b);P(t,"onHide",C);P(t,"onUnload",C);if(t.onShareAppMessage){var e=t.onShareAppMessage;t.onShareAppMessage=function(n){var t=e.call(this,n);return Kn.trackShare.call(this,t)}}jn(n)}catch(t){jn(n)}}}catch(n){M().w("Component重写异常")}var Fn=new k,Kn={_inited:!1,init:function(n){M().tip_w("2.3.2及之后版本需在微信后台更换域名白名单为: umini.shujupie.com");if(this._inited)M().v("已经实例过，请避免重复初始化");else if(n)if(n.appKey){"boolean"!=typeof n.useOpenid&&(n.useOpenid=!0);F().set(n);M().setDebug(n.debug);this._inited=!0;var t=this;if(F().useOpenid()){M().tip_w("您选择了使用openid进行统计，请确保使用setOpenid回传openid或通过设置autoGetOpenid为true，并在友盟后台设置secret由友盟帮您获取")}!function(n){try{var t=new R;M().v("成功创建Lib对象");t.init(function(){M().v("Lib对象初始化成功");Fn.installApi(n,t);M().v("安装Lib接口成功")})}catch(n){M().w("创建Lib对象异常: "+n)}}(t)}else M().err("请确保传入正确的appkey");else M().err("请通过在App内添加umengConfig设置相关信息！")}};try{Fn.installApi(Kn,null);M().v("安装临时接口成功");wx.uma=Kn}catch(n){M().w("uma赋值异常: ",n)}module.exports=Kn;
